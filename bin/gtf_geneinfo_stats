#!/usr/bin/env ruby
require "benchmarking_scripts"
require 'optparse'

options = {}

opt_parser = OptionParser.new do |opt|
  opt.banner = "Usage: #{$0} CMD file1 file2 [OPTIONS]"
  opt.separator  ""
  opt.separator  "CMD"
  opt.separator  "     gff: if file1 is gff format"
  opt.separator  "     gtf: if file1 is gtf format"
  opt.separator  ""
  opt.separator  "Options"

  opt.on("-e","--environment ENVIRONMENT","which environment you want server run") do |environment|
    options[:environment] = environment
  end

  opt.on("-d","--daemon","runing on daemon mode?") do
    options[:daemon] = true
  end

  opt.on("-h","--help","help") do
    STDERR.puts opt_parser
    exit
  end
end

opt_parser.parse!


case ARGV[0]
when "gff"
  if ARGV.length >= 3
    transcripts = ARGV[1]
    geneinfo = ARGV[2]
    compare_obj = CompareGenesGFF.new(geneinfo,transcripts)
  else
    STDERR.puts "\nPlease specify files"
    STDERR.puts opt_parser
    exit
  end
when "gtf"
  if ARGV.length >= 3
    transcripts = ARGV[1]
    geneinfo = ARGV[2]
    compare_obj = CompareGenesGTF.new(geneinfo,transcripts)
  else
    STDERR.puts "Please specify files"
    STDERR.puts opt_parser
    exit
  end
when ""
  STDERR.puts "Please pick a runmode"
  STDERR.puts opt_parser
  exit
else
  STDERR.puts opt_parser
  exit
end

compare_obj.compare_file.create_index()
compare_obj.geneinfo.create_index()
compare_obj.statistics()
puts (["#splice_forms"] + (0..10).to_a).join("\t")
puts "---------------------------------------------------------------------------------------------------------"
puts (["#Strong TP"] + compare_obj.strong_TP).join("\t")
puts (["# Weak TP"] + compare_obj.weak_TP).join("\t")
puts (["# All FP"] + compare_obj.all_FP).join("\t")

